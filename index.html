    <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Trinity Episcopal De Soto â€” Calendar</title>
  <meta name="description" content="Monthly events & services at Trinity Episcopal Church, De Soto, MO. All are welcome." />
  <link rel="canonical" href="https://example.org/" />
  <meta name="theme-color" content="#0b1220" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Trinity Episcopal De Soto â€” Calendar" />
  <meta property="og:title" content="Trinity Episcopal De Soto â€” Calendar" />
  <meta property="og:description" content="Monthly events & services at Trinity Episcopal Church, De Soto, MO." />
  <meta property="og:image" content="assets/view-calendar.png?v=214" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Trinity Episcopal De Soto â€” Calendar" />
  <meta name="twitter:description" content="Monthly events & services at Trinity Episcopal Church, De Soto, MO." />
  <meta name="twitter:image" content="assets/view-calendar.png?v=214" />

  <style>
    :root{
      --panel:#ffffff; --ink:#0b1220; --muted:#475569;
      --accent:#16a34a; --accent-2:#2563eb;
      --grid:#cbd5e1; --tint:#f8fafc;
      --error:#b91c1c; --focus:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--ink);background:#fff}
    a{color:var(--accent-2);text-underline-offset:2px}
    .app{max-width:980px;margin:14px auto;padding:12px}
    .header{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center}
    .brand h1{font-size:22px;margin:0}
    .brand small{display:block;color:var(--muted)}
    .cta img{height:44px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,.15)}
    .toolbar{display:flex;gap:8px;justify-content:flex-end;align-items:center}
    button{background:#fff;color:var(--ink);border:1px solid var(--grid);padding:8px 10px;border-radius:8px;cursor:pointer}
    button:hover{background:var(--tint)}
    button:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
    .monthbar{display:flex;align-items:center;gap:10px;margin:10px 0}
    .monthbar h2{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .dow{font-weight:600;color:var(--muted);text-align:center;padding:6px 0}
    .cell{border:1px solid var(--grid);border-radius:8px;min-height:120px;padding:6px;background:#fff}
    .cell.other{background:#fafafa;color:#6b7280}
    .date{font-weight:600;font-size:12px;color:#0f172a}
    .ev{margin-top:4px;padding:4px;border-left:3px solid var(--accent-2);background:#f1f5f9;border-radius:4px}
    .ev.holiday{border-left-color:#16a34a;background:#ecfdf5}
    .ev time{font-size:12px;color:#0f172a}
    .ev .t{font-weight:600;display:block;margin:2px 0}
    .ev a.ics{font-size:12px}
    .split{display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-top:14px}
    .card{border:1px solid var(--grid);border-radius:10px;padding:10px;background:#fff}
    .card h3{margin:0 0 6px;font-size:16px}
    .legend{display:flex;flex-wrap:wrap;gap:8px}
    .tag{border:1px dashed var(--grid);border-radius:8px;padding:4px 8px;font-size:12px;background:#fff}
    .footer{margin-top:16px;color:var(--muted);text-align:center;font-size:13px}
    .error{border:1px solid var(--error);background:#fef2f2;color:#7f1d1d;border-radius:10px;padding:10px}
  </style>
</head>
<body>
  <div class="app" id="app" hidden>
    <header class="header">
      <div class="brand">
        <h1>Trinity Episcopal De Soto â€” Calendar</h1>
        <small>Monthly events &amp; services</small>
      </div>
      <a class="cta" href="#/" aria-label="View Calendar">
        <img src="assets/view-calendar.png?v=214" alt="View Calendar" />
      </a>
      <div class="toolbar">
        <button id="btn-today">Today</button>
        <button id="btn-print">ðŸ–¨ Print Calendar</button>
      </div>
    </header>

    <div class="monthbar">
      <div class="nav">
        <button id="prev">â—€</button>
        <button id="next">â–¶</button>
      </div>
      <h2 id="monthlabel"></h2>
    </div>

    <div id="err" class="error" hidden>
      <strong>Couldnâ€™t load events.</strong> Please try again:
      <button id="retry">Retry</button>
    </div>

    <section class="grid" id="dow"></section>
    <section class="grid" id="calendar"></section>

    <div class="split">
      <section class="card">
        <h3>Upcoming (next 10)</h3>
        <ul id="upcoming"></ul>
      </section>
      <section class="card">
        <h3>Legend</h3>
        <div class="legend">
          <span class="tag">Sunday Service</span>
          <span class="tag">AA Group 148</span>
          <span class="tag">AA Group 147</span>
          <span class="tag">NA</span>
          <span class="tag">Carry-In Dinner</span>
          <span class="tag">US Holidays</span>
        </div>
      </section>
    </div>

    <footer class="footer">
      Trinity Episcopal Church, 202 W. Miller Street, De Soto, MO 63020 | (636) 586-2542
    </footer>
  </div>

  <script>
  (function(){
    'use strict';

    // ---------- Config ----------
    const TZ = 'America/Chicago';
    const ASSETS_VERSION = '214';
    const EVENTS_URLS = [
      `./assets/events.json?v=${ASSETS_VERSION}`,
      `/assets/events.json?v=${ASSETS_VERSION}`
    ];
    const DOW = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const DOW_MAP = {SU:0, MO:1, TU:2, WE:3, TH:4, FR:5, SA:6};
    const fmtMonth = new Intl.DateTimeFormat('en-US',{timeZone:TZ, month:'long', year:'numeric'});
    const fmtDayNum = new Intl.DateTimeFormat('en-US',{timeZone:TZ, day:'numeric'});
    const fmtTime = new Intl.DateTimeFormat('en-US',{timeZone:TZ, hour:'numeric', minute:'2-digit'});

    const app = document.getElementById('app');
    const monthlabel = document.getElementById('monthlabel');
    const gridEl = document.getElementById('calendar');
    const dowEl = document.getElementById('dow');
    const upcomingEl = document.getElementById('upcoming');
    const errEl = document.getElementById('err');

    // ---------- Data load ----------
    window.RAW = null;
    async function loadEvents(){
      errEl.hidden = true;
      let lastError = null;
      for (const url of EVENTS_URLS) {
        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          if (!data || !Array.isArray(data.events)) throw new Error('Bad JSON');
          window.RAW = data;
          console.log('[calendar] loaded from', url);
          return data;
        } catch (e) {
          lastError = e;
          console.warn('[calendar] failed', url, e);
        }
      }
      throw lastError || new Error('No events.json could be loaded');
    }

    // ---------- Helpers (shortened here for clarity) ----------
    // (Use the same functions you already had: partsInTZ, zonedDate, expandEventForMonth, etc.)

    // ---------- Render + Boot ----------
    async function refresh(){
      const now = new Date();
      monthlabel.textContent = fmtMonth.format(now);
      app.hidden = false;
    }

    document.getElementById('btn-print').addEventListener('click', ()=>window.print());
    document.getElementById('btn-today').addEventListener('click', ()=>location.hash='');

    loadEvents()
      .then(refresh)
      .catch(()=>{ errEl.hidden=false; app.hidden=false; });
  })();
  </script>
</body>
</html>

  
