    chip.textContent = season.name; chip.style.background = season.color; chip.style.color = '#fff';

    const rangeStart = cells[0], rangeEnd = cells[cells.length-1];
    allEvents = expandEventsInRange(rawEvents, rangeStart, rangeEnd);

    const byDay = new Map();
    for(const e of allEvents.map(e=>({...e, d:new Date(e.start)})).sort((a,b)=> a.d-b.d || a.title.localeCompare(b.title))){
      const k = ymd(e.d);
      if(!byDay.has(k)) byDay.set(k, []);
      byDay.get(k).push(e);
    }

    document.getElementById('calendar').innerHTML = cells.map(d => {
      const k = ymd(d);
      const inMonth = d.getMonth()===current.getMonth();
      const list = (byDay.get(k)||[]).map(renderEvent).join('');
      return `<div class="cell" style="opacity:${inMonth?1:0.48}">
        <div class="date">${fmtDate(d,{day:'numeric'})}</div>
        ${list||''}
      </div>`;
    }).join('');

    const today = new Date();
    const future = expandEventsInRange(rawEvents, today, addDays(today, 180));
    const next10 = future.sort((a,b)=> new Date(a.start)-new Date(b.start)).slice(0,10);
    document.getElementById('upcoming').innerHTML = next10.map(e=>`
      <li class="up-item">
        <div class="up-date">${fmtDate(new Date(e.start), { weekday:'short', month:'short', day:'numeric'})}</div>
        <div><span class="badge ${e.type}">${badgeText(e)}</span> ${escapeHtml(e.title)}</div>
      </li>`).join('');

    document.getElementById('app').hidden = false;
  }

  function renderEvent(e){
    const cls = `event ${e.type}`;
    const t = isAllDay(e) ? '' : ` <span class="muted">â€” ${timeLabel(e.start)}</span>`;
    const add = `<a class="addbtn" href="${gcalUrl(e)}" target="_blank" rel="noopener">Add to Google</a>`;
    return `<div class="${cls}"><span class="badge ${e.type}">${badgeText(e)}</span> ${escapeHtml(e.title)}${t} ${add}</div>`;
  }
  function badgeText(e){
    if(e.type==='aa') return 'AA';
    if(e.type==='na') return 'NA';
    if(e.type==='svc') return 'Service';
    if(e.type==='holy') return 'Holy Day';
    return 'Event';
  }
  function escapeHtml(s=''){return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))}

  // ---------- NAV + VIEW/HIDE
  function goToCalendar(){
